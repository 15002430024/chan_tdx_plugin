# 缠论通达信DLL插件

基于缠论理论的通达信技术分析插件。

## ⚠️ 当前状态：开发中

**核心算法已完成（40个单元测试通过），但通达信集成存在问题。**

详见 [ISSUE.md](ISSUE.md) - DLL 加载成功、RegisterTdxFunc 被调用，但函数在公式编辑器中无法识别。

## 功能列表

| 函数名 | 功能 | 输出说明 |
|--------|------|----------|
| CHAN_FX | 分型标记 | 1=顶分型, -1=底分型, 0=无 |
| CHAN_BI | 笔端点 | 笔端点价格，非端点为0 |
| CHAN_DUAN | 线段端点 | 线段端点价格 |
| CHAN_ZS_H | 中枢高点 | 中枢区间内为ZG值 |
| CHAN_ZS_L | 中枢低点 | 中枢区间内为ZD值 |
| CHAN_BUY | 买点信号 | 1/2/3=买点类型, 0=无 |
| CHAN_SELL | 卖点信号 | 1/2/3=卖点类型, 0=无 |
| CHAN_BUYX | 综合买点信号 | 标准(1-3)/类二买(31-32)/准买点(41-43) |
| CHAN_SELLX | 综合卖点信号 | 标准(1-3)/类二卖(31-32)/准卖点(41-43) |
| CHAN_BC | 背驰标记 | 1=顶背驰, -1=底背驰, 0=无 |

## 构建方法

### 环境要求

- Visual Studio 2019 或 2022
- CMake 3.15+
- Windows SDK

### 构建步骤

```batch
# 1. 创建构建目录
mkdir build
cd build

# 2. 生成项目 (必须使用Win32)
cmake -G "Visual Studio 17 2022" -A Win32 ..

# 3. 编译
cmake --build . --config Release
```

### 输出文件

编译成功后，在 `build/bin/Release/` 目录下生成 `chan.dll`。

## 安装方法

1. 将 `chan.dll` 复制到通达信安装目录的 `T0002/dlls/` 文件夹
2. 修改 `T0002/dlls/dlls.ini`，添加一行：
   ```ini
   [BAND]
   band1=chan.dll
   ```
3. 重启通达信

## 公式调用示例

```
{分型标记}
FX:CHAN_FX(4);

{笔端点}
BI:CHAN_BI(4);

{中枢区间}
ZS_H:CHAN_ZS_H(4);
ZS_L:CHAN_ZS_L(4);

{标准买卖点}
BUY:CHAN_BUY(4);
SELL:CHAN_SELL(4);

{综合买卖点（含准买卖点和类二买卖）}
BUYX:CHAN_BUYX(4);
SELLX:CHAN_SELLX(4);
{输出说明: 1-3=标准买卖点, 31=类二买A, 32=类二买AAA, 41=准一买, 42=准二买, 43=准三买}
```

## 版本历史

- v1.3.0 (2025-01-25): P4阶段完成，准买卖点与类二买卖功能
  - 准一/二/三买卖点检测（条件放宽版本）
  - 类二买/卖判断（A型85%、AAA型90%成功率）
  - 综合信号优先级输出（CHAN_BUYX/CHAN_SELLX）
- v1.2.0 (2025-01-22): P3阶段完成，123买卖点标准实现
- v1.1.0 (2025-01-18): P2阶段完成，递归引用体系
- v1.0.0 (2025-12-29): P1阶段完成，空壳DLL

## 许可证

MIT License
